<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>我的旅行时间线</title>
  <meta name="description" content="按时间记录我的旅行足迹：月份、地区与照片。"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='80'>🗺️</text></svg>">
  <style>
    :root{
      --bg:#0d1117; --bg2:#0a0f1a; --card:#111827; --fg:#e6edf3; --muted:#9fb0c9;
      --accent:#7aa2ff; --accent2:#9fe6a0; --border:rgba(255,255,255,.08);
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35); --focus:0 0 0 3px rgba(122,162,255,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--fg);
      background:
        radial-gradient(900px 600px at 20% 0%, #182147 0%, transparent 60%),
        radial-gradient(800px 500px at 100% 0%, #1b2a58 0%, transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      line-height:1.75;
    }
    a{color:var(--accent); text-decoration:none}
    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible{outline:none; box-shadow:var(--focus); border-radius:10px}
    img{max-width:100%; display:block}
    .container{max-width:980px; margin:0 auto; padding:0 20px}
    .card{background:linear-gradient(180deg,#111a33,#0f172b); border:1px solid var(--border);
          border-radius:var(--radius); box-shadow:var(--shadow)}
    .btn{display:inline-block; padding:8px 12px; border:1px solid var(--border); border-radius:12px; background:#0f1830; color:#d9e2ef; cursor:pointer}
    .btn.ghost{background:#0c1329}
    .chip{padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#101a33; color:#d8e3f3; cursor:pointer}
    .chip.active{background:#1a2a4a}

    .skip{position:absolute; left:-9999px}
    .skip:focus{left:20px; top:12px; background:#121a2f; padding:8px 12px; border-radius:10px; z-index:1100}

    header{position:sticky; top:0; z-index:50; backdrop-filter: blur(8px); background: rgba(8,12,24,.6); border-bottom:1px solid var(--border)}
    .nav{display:flex; align-items:center; justify-content:space-between; height:64px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .logo{width:28px; height:28px; display:grid; place-items:center; background:linear-gradient(135deg,#7aa2ff,#9fe6a0); color:#0b1020; border-radius:8px; font-weight:900}

    .hero{padding:80px 0 20px}
    .hero h1{margin:0 0 8px; font-size: clamp(28px, 6vw, 48px)}
    .hero p{margin:0; color:var(--muted)}

    .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:16px 0}
    .subbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:-8px 0 10px 0}
    .input{padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#0f1528; color:#dbe6f7}

    /* 横向时间轴 */
    .year-rail-wrap{position:sticky; top:64px; z-index:5; background:rgba(8,12,24,.7); backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border)}
    .year-rail{display:flex; gap:8px; overflow-x:auto; padding:10px 0}
    .year-pill{white-space:nowrap; padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#0f172b; color:#cfe1ff; cursor:pointer}
    .year-pill.active{background:#1a2a4a}

    /* 纵向时间线 */
    .timeline{position:relative; padding:6px 0 30px}
    .timeline::before{content:''; position:absolute; left:18px; top:0; bottom:0; width:2px; background:linear-gradient(180deg,#27325a,#1a2244)}
    .year{position:relative; margin:16px 0 8px; display:inline-block; padding:6px 12px; border:1px solid var(--border); border-radius:999px; background:#0f172b; color:#cfe1ff}
    .entry{position:relative; margin:12px 0 16px; padding:14px 14px 12px 54px; border:1px solid var(--border)}
    .entry::before{content:''; position:absolute; left:10px; top:18px; width:16px; height:16px; border-radius:50%; background:linear-gradient(135deg,#7aa2ff,#9fe6a0); box-shadow:0 0 0 4px rgba(122,162,255,.15)}
    .entry h3{margin:0 0 6px; font-size:20px}
    .meta{color:#9fb0c9; font-size:13px; margin-bottom:8px}
    .thumb{overflow:hidden; border-radius:12px; border:1px solid var(--border); aspect-ratio: 16/10; background:#0e1630}
    .thumb img{
      width:100%; 
      height:100%; 
      object-fit:contain;  /* 使用contain使图片完全显示，不裁剪 */
    }

    dialog{border:none; padding:0; border-radius:14px; overflow:hidden; background:#0b0f1c}
    .lightbox img{display:block; width:100%; height:auto; object-fit:contain;}
    .lightbox .bar{display:flex; justify-content:space-between; align-items:center; padding:8px 12px; background:#0f172b; border-bottom:1px solid var(--border)}
    .close{background:#0e1630; color:#e6edf3; border:1px solid var(--border); border-radius:8px; padding:6px 10px; cursor:pointer}

    footer{padding:28px 0; color:#9fb0c9; border-top:1px solid var(--border)}

    /* 控制灯箱按钮位置 */
    .lightbox .btns { display: flex; justify-content: space-between; width: 100%; }
    .btns button { background: #0f172b; color: #e6edf3; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>
  <a class="skip" href="#main">跳到主内容</a>

  <header>
    <div class="container nav" aria-label="主导航">
      <div class="brand"><div class="logo" aria-hidden="true">✦</div><span>我的旅行时间线</span></div>
      <nav aria-label="辅助链接">
        <!-- 导入和导出功能已删除 -->
      </nav>
    </div>
  </header>

  <main id="main">
    <section class="hero">
      <div class="container">
        <h1>按时间记录我的旅行</h1>
      </div>
    </section>

    <!-- 工具栏 -->
    <section class="container">
      <div class="toolbar">
        <strong>年份：</strong>
        <select id="yearSel" class="input">
          <option value="all">全部年份</option>
        </select>

        <strong>范围：</strong>
        <div id="scopeWrap" style="display:flex; gap:8px; flex-wrap:wrap"></div>

        <input id="q" class="input" style="flex:1; min-width:200px" placeholder="搜索：标题 / 备注 / 省份 / 国家"/>
      </div>

      <!-- 仅在 scope=国内 时显示 -->
      <div class="subbar" id="provBar" hidden>
        <strong>省份：</strong>
        <div id="provWrap" style="display:flex; gap:8px; flex-wrap:wrap"></div>
      </div>
    </section>

    <!-- 横向时间轴 -->
    <div class="year-rail-wrap">
      <div class="container">
        <div id="yearRail" class="year-rail" role="tablist" aria-label="年份时间轴">
          <!-- JS 渲染年份与月份 pill -->
        </div>
      </div>
    </div>

    <!-- 纵向时间线 -->
    <section class="container timeline card" id="timeline" aria-label="旅行时间线"></section>

    <!-- 图片灯箱 -->
    <dialog class="lightbox" id="dlg" aria-label="图片预览">
      <div class="bar">
        <button class="close" id="closeBtn" aria-label="关闭预览">关闭</button>
      </div>
      <div class="btns">
        <button id="prevBtn">上一张</button>
        <button id="nextBtn">下一张</button>
      </div>
      <img id="big" alt="图片预览">
    </dialog>
  </main>

  <footer>
    <div class="container" style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap">
      <span>© <span id="year"></span> 印宇浩·走软作业</span>
    </div>
  </footer>

  <script>
    // 年份
    document.getElementById('year').textContent = new Date().getFullYear();

    // 旅行数据
     const TRIPS = [
      { id:"201109-hangzhou", date:"2011-09", title:"杭州", scope:"国内", province:"浙江", cover:"images/201109杭州3.jpg", gallery:["images/201109杭州1.jpg","images/201109杭州2.jpg"] },
      { id:"201410-tianjin", date:"2014-10", title:"天津", scope:"国内", province:"天津", cover:"images/201410天津3.JPG", gallery:["images/201410天津1.JPG","images/201410天津2.JPG","images/201410天津3.JPG","images/201410天津4.JPG"] },
      { id:"201502-harbin", date:"2015-02", title:"哈尔滨冰雪节", scope:"国内", province:"黑龙江", cover:"images/201502哈尔滨1.JPG", gallery:["images/201502哈尔滨2.JPG","images/201502哈尔滨3.JPG","images/201502哈尔滨4.JPG"] },
      { id:"201508-changzhou", date:"2015-08", title:"常州水上乐园", scope:"国内", province:"江苏", cover:"images/201508南京、常州3.jpg", gallery:["images/201508南京、常州3.jpg"] },
      { id:"201508-nanjing", date:"2015-08", title:"南京", scope:"国内", province:"江苏", cover:"images/201508南京、常州2.jpg", gallery:["images/201508南京、常州2.jpg","images/201508南京、常州4.jpg","images/201508南京、常州5.jpg"] },
      { id:"201608-shanghai", date:"2016-08", title:"上海", scope:"国内", province:"上海", cover:"images/201608上海4.JPG", gallery:["images/201608上海1.JPG","images/201608上海2.JPG","images/201608上海3.JPG"] },
      { id:"201710-suzhou", date:"2017-10", title:"苏州", scope:"国内", province:"江苏", cover:"images/201710苏州.JPG", gallery:["images/201710苏州.JPG"] },
      { id:"201802-xian", date:"2018-02", title:"西安", scope:"国内", province:"陕西", cover:"images/201802西安、壶口瀑布1.JPG", gallery:["images/201802西安、壶口瀑布2.JPG","images/201802西安、壶口瀑布3.JPG"] },
      { id:"201808-xiong'an", date:"2018-08", title:"雄安", scope:"国内", province:"河北", cover:"images/201808雄安、白洋淀1.JPG", gallery:["images/201808雄安、白洋淀2.JPG"] },
      { id:"201810-chengdu", date:"2018-10", title:"成都", scope:"国内", province:"四川", cover:"images/201810成都、青城山、都江堰1.JPG", gallery:["images/201810成都、青城山、都江堰2.JPG","images/201810成都、青城山、都江堰3.JPG","images/201810成都、青城山、都江堰4.JPG"] },
      { id:"201910-anyang", date:"2019-10", title:"安阳", scope:"国内", province:"河南", cover:"images/201910安阳2.JPG", gallery:["images/201910安阳1.JPG","images/201910安阳3.JPG","images/201910安阳4.jpg"] },
      { id:"202105-luoyang", date:"2021-05", title:"洛阳", scope:"国内", province:"河南", cover:"images/202105洛阳.JPG", gallery:["images/202105洛阳.JPG"] },
      { id:"202508-yangzhou", date:"2025-08", title:"扬州", scope:"国内", province:"江苏", cover:"images/202508扬州1.JPG", gallery:["images/202508扬州2.jpg","images/202508扬州3.jpg","images/202508扬州4.jpg","images/202508扬州5.jpg","images/202508扬州6.JPG"] },
      { id:"202001-yunnan", date:"2020-01", title:"云南", scope:"国内", province:"云南", cover:"images/202001云南1.JPG", gallery:["images/202001云南2.JPG","images/202001云南3.JPG","images/202001云南4.JPG","images/202001云南5.JPG","images/202001云南6.JPG"] },
      { id:"202307-shenyang", date:"2023-07", title:"沈阳", scope:"国内", province:"辽宁", cover:"images/202307沈阳1.jpg", gallery:["images/202307沈阳2.jpg","images/202307沈阳3.jpg"] },
      { id:"202310-wuxi", date:"2023-10", title:"无锡", scope:"国内", province:"江苏", cover:"images/202310无锡2.jpg", gallery:["images/202310无锡1.jpg","images/202310无锡3.jpg"] },
      { id:"202401-guangzhou", date:"2024-01", title:"广州", scope:"国内", province:"广东", cover:"images/202401广州7.jpg", gallery:["images/202401广州8.jpg","images/202401广州3.jpg","images/202401广州4.jpg","images/202401广州6.jpg"] },
      { id:"201608-korea", date:"2016-08", title:"韩国", scope:"国外", province:"", cover:"images/201608韩国游轮游1.JPG", gallery:["images/201608韩国游轮游2.JPG","201608韩国游轮游3.JPG"] }
    ];

    // ==== 2) 状态 ====  
    const state = { year:'all', scope:'全部', province:'全部', q:'' };
    const yearSel = document.getElementById('yearSel');
    const scopeWrap = document.getElementById('scopeWrap');
    const provBar = document.getElementById('provBar');
    const provWrap = document.getElementById('provWrap');
    const yearRail = document.getElementById('yearRail');

    // 年份列表
    const years = Array.from(new Set(TRIPS.map(t => t.date.slice(0, 7)))).sort((a, b) => b - a);
    years.forEach(y => { 
      const opt = document.createElement('option'); 
      opt.value = y; 
      opt.textContent = y; 
      yearSel.appendChild(opt); 
    });

    // 范围芯片
    ['全部', '国内', '国外'].forEach(s => { 
      const b = document.createElement('button');
      b.className = 'chip' + (s === '全部' ? ' active' : '');
      b.textContent = s; 
      b.dataset.scope = s;
      scopeWrap.appendChild(b);
    });

    // 省份芯片
    function buildProvinces() {
      provWrap.innerHTML = '';
      const set = new Set(['全部']);
      TRIPS.filter(t => t.scope === '国内' && t.province).forEach(t => set.add(t.province));
      Array.from(set).forEach(p => {
        const b = document.createElement('button');
        b.className = 'chip' + (p === '全部' ? ' active' : '');
        b.textContent = p; 
        b.dataset.province = p; 
        provWrap.appendChild(b);
      });
    }
    buildProvinces();

    // 横向时间轴 pills
    function buildYearRail() {
      yearRail.innerHTML = '';
      years.forEach(y => {
        const a = document.createElement('button');
        a.className = 'year-pill';
        a.textContent = y; 
        a.dataset.year = y; 
        a.setAttribute('role', 'tab');
        yearRail.appendChild(a);
      });
    }
    buildYearRail();

    // ==== 3) 交互 ====  
    document.getElementById('q').addEventListener('input', (e) => { 
      state.q = (e.target.value || '').toLowerCase().trim(); 
      render(); 
    });
    yearSel.addEventListener('change', () => { 
      state.year = yearSel.value; 
      render(true); 
    });
    scopeWrap.addEventListener('click', (e) => { 
      const btn = e.target.closest('button.chip'); 
      if (!btn) return;
      scopeWrap.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
      btn.classList.add('active'); 
      state.scope = btn.dataset.scope;
      const showProv = state.scope === '国内';
      provBar.hidden = !showProv;
      state.province = '全部';
      if (showProv) {
        provWrap.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
        const first = provWrap.querySelector('[data-province="全部"]'); 
        if (first) first.classList.add('active');
      }
      render(true); 
    });

    provWrap.addEventListener('click', (e) => { 
      const btn = e.target.closest('button.chip'); 
      if (!btn) return;
      provWrap.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
      btn.classList.add('active'); 
      state.province = btn.dataset.province;
      render(true);
    });

    // 时间轴点击跳转
    yearRail.addEventListener('click', (e) => {
      const btn = e.target.closest('button.year-pill'); 
      if (!btn) return;
      const targetYear = btn.dataset.year;
      const anchor = document.querySelector(`[data-year-anchor="${targetYear}"]`);
      if (anchor) { anchor.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
    });

    function filterTrips(list) {
      return list.filter(t => {
        const yOk = state.year === 'all' || t.date.startsWith(state.year);
        const sOk = state.scope === '全部' || t.scope === state.scope;
        const pOk = state.province === '全部' || t.province === state.province;
        return yOk && sOk && pOk;
      });
    }

    // ==== 4) 渲染 ====  
    function render(rebuildAnchors = false) {
      const wrap = document.getElementById('timeline');
      wrap.innerHTML = '';
      const data = filterTrips([...TRIPS]).sort((a, b) => b.date.localeCompare(a.date));
      if (data.length === 0) {
        const empty = document.createElement('p'); 
        empty.style.color = 'var(--muted)'; 
        empty.style.margin = '16px';
        empty.textContent = '没有匹配的旅行记录。试试更换筛选或关键词。'; 
        wrap.appendChild(empty); 
        return;
      }

      let curYear = null;
      data.forEach(t => {
        const y = t.date.slice(0, 7); 
        if (curYear !== y) {
          curYear = y;
          const tag = document.createElement('div'); 
          tag.className = 'year'; 
          tag.textContent = y;
          tag.setAttribute('data-year-anchor', y); 
          wrap.appendChild(tag);
        }

        const metaPieces = [
          `<time datetime="${t.date}">${t.date}</time>`,
          t.scope === '国内' ? `国内·${t.province || '未填省份'}` : `国外${t.country ? '·' + t.country : ''}`
        ];

        const art = document.createElement('article'); 
        art.className = 'entry card';
        art.innerHTML = `
          <div class="meta">${metaPieces.join(' · ')}</div>
          <h3>${t.title}</h3>
          <div class="thumb"><img src="${t.cover || ''}" alt="${t.title} 封面" loading="lazy"></div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
            <button class="btn" data-view="${t.id}">查看照片（${(t.gallery || []).length || 1}）</button>
          </div>
        `;
        wrap.appendChild(art);
      });

      if (rebuildAnchors) { updateYearRailActive(); }
    }
    render(true);

    // ==== 5) 时间轴滚动高亮（IntersectionObserver）====  
    const yearAnchors = () => Array.from(document.querySelectorAll('[data-year-anchor]'));
    function updateYearRailActive(activeYear) {
      const pills = Array.from(yearRail.querySelectorAll('.year-pill'));
      pills.forEach(p => p.classList.toggle('active', p.dataset.year === activeYear));
    }
    const io = new IntersectionObserver(entries => {
      const visible = entries.filter(e => e.isIntersecting).sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top);
      if (visible[0]) {
        const y = visible[0].target.getAttribute('data-year-anchor');
        updateYearRailActive(y);
      }
    }, { rootMargin: "-64px 0px -70% 0px", threshold: [0, 1] });
    function observeYears() {
      io.disconnect();
      yearAnchors().forEach(el => io.observe(el));
    }
    observeYears();

    // ==== 6) 灯箱（Lightbox）功能 ====  
    const dlg = document.getElementById('dlg'), big = document.getElementById('big'), closeBtn = document.getElementById('closeBtn');
    let currentPhotos = [], currentIndex = -1;

    // 监听“查看照片”按钮点击事件
    document.getElementById('timeline').addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-view]'); 
      if (!btn) return;

      const id = btn.dataset.view; 
      const trip = TRIPS.find(x => x.id === id); 
      if (!trip) return;

      // 获取所有图片：封面图片 + gallery 中的图片
      currentPhotos = [trip.cover, ...(trip.gallery || [])].filter(Boolean); 
      currentIndex = 0;
      showPhoto(currentIndex);
      dlg.showModal();
    });

    // 显示当前索引的图片
    function showPhoto(i) {
      if (i < 0 || i >= currentPhotos.length) return; 
      const src = currentPhotos[i] || ''; 
      big.src = src; 
      big.alt = '旅行照片 ' + (i + 1);
    }

    // 关闭灯箱
    closeBtn.addEventListener('click', () => dlg.close());

    // 切换图片
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + currentPhotos.length) % currentPhotos.length; 
      showPhoto(currentIndex);
    });

    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % currentPhotos.length; 
      showPhoto(currentIndex);
    });
  </script>
</body>
</html>























