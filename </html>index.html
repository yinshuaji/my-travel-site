<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>æˆ‘çš„æ—…è¡Œæ—¶é—´çº¿</title>
  <meta name="description" content="æŒ‰æ—¶é—´è®°å½•æˆ‘çš„æ—…è¡Œè¶³è¿¹ï¼šæœˆä»½ã€åœ°åŒºä¸ç…§ç‰‡ã€‚"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='80'>ğŸ—ºï¸</text></svg>">
  <style>
    :root{
      --bg:#0d1117; --bg2:#0a0f1a; --card:#111827; --fg:#e6edf3; --muted:#9fb0c9;
      --accent:#7aa2ff; --accent2:#9fe6a0; --border:rgba(255,255,255,.08);
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35); --focus:0 0 0 3px rgba(122,162,255,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--fg);
      background:
        radial-gradient(900px 600px at 20% 0%, #182147 0%, transparent 60%),
        radial-gradient(800px 500px at 100% 0%, #1b2a58 0%, transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
      line-height:1.75;
    }
    a{color:var(--accent); text-decoration:none}
    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible{outline:none; box-shadow:var(--focus); border-radius:10px}
    img{max-width:100%; display:block}
    .container{max-width:980px; margin:0 auto; padding:0 20px}
    .card{background:linear-gradient(180deg,#111a33,#0f172b); border:1px solid var(--border);
          border-radius:var(--radius); box-shadow:var(--shadow)}
    .btn{display:inline-block; padding:8px 12px; border:1px solid var(--border); border-radius:12px; background:#0f1830; color:#d9e2ef; cursor:pointer}
    .btn.ghost{background:#0c1329}
    .chip{padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#101a33; color:#d8e3f3; cursor:pointer}
    .chip.active{background:#1a2a4a}

    .skip{position:absolute; left:-9999px}
    .skip:focus{left:20px; top:12px; background:#121a2f; padding:8px 12px; border-radius:10px; z-index:1100}

    header{position:sticky; top:0; z-index:50; backdrop-filter: blur(8px); background: rgba(8,12,24,.6); border-bottom:1px solid var(--border)}
    .nav{display:flex; align-items:center; justify-content:space-between; height:64px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .logo{width:28px; height:28px; display:grid; place-items:center; background:linear-gradient(135deg,#7aa2ff,#9fe6a0); color:#0b1020; border-radius:8px; font-weight:900}

    .hero{padding:80px 0 20px}
    .hero h1{margin:0 0 8px; font-size: clamp(28px, 6vw, 48px)}
    .hero p{margin:0; color:var(--muted)}

    .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:16px 0}
    .subbar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:-8px 0 10px 0}
    .input{padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#0f1528; color:#dbe6f7}

    /* æ¨ªå‘æ—¶é—´è½´ */
    .year-rail-wrap{position:sticky; top:64px; z-index:5; background:rgba(8,12,24,.7); backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border)}
    .year-rail{display:flex; gap:8px; overflow-x:auto; padding:10px 0}
    .year-pill{white-space:nowrap; padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#0f172b; color:#cfe1ff; cursor:pointer}
    .year-pill.active{background:#1a2a4a}

    /* çºµå‘æ—¶é—´çº¿ */
    .timeline{position:relative; padding:6px 0 30px}
    .timeline::before{content:''; position:absolute; left:18px; top:0; bottom:0; width:2px; background:linear-gradient(180deg,#27325a,#1a2244)}
    .year{position:relative; margin:16px 0 8px; display:inline-block; padding:6px 12px; border:1px solid var(--border); border-radius:999px; background:#0f172b; color:#cfe1ff}
    .entry{position:relative; margin:12px 0 16px; padding:14px 14px 12px 54px; border:1px solid var(--border)}
    .entry::before{content:''; position:absolute; left:10px; top:18px; width:16px; height:16px; border-radius:50%; background:linear-gradient(135deg,#7aa2ff,#9fe6a0); box-shadow:0 0 0 4px rgba(122,162,255,.15)}
    .entry h3{margin:0 0 6px; font-size:20px}
    .meta{color:#9fb0c9; font-size:13px; margin-bottom:8px}
    .thumb{overflow:hidden; border-radius:12px; border:1px solid var(--border); aspect-ratio: 16/10; background:#0e1630}
    .thumb img{
      width:100%; 
      height:100%; 
      object-fit:contain;  /* ä½¿ç”¨containä½¿å›¾ç‰‡å®Œå…¨æ˜¾ç¤ºï¼Œä¸è£å‰ª */
    }

    dialog{border:none; padding:0; border-radius:14px; overflow:hidden; background:#0b0f1c}
    .lightbox img{display:block; width:100%; height:auto; object-fit:contain;}
    .lightbox .bar{display:flex; justify-content:space-between; align-items:center; padding:8px 12px; background:#0f172b; border-bottom:1px solid var(--border)}
    .close{background:#0e1630; color:#e6edf3; border:1px solid var(--border); border-radius:8px; padding:6px 10px; cursor:pointer}
    .lightbox {
      width: 90vw;  /* è®¾ç½®å®½åº¦ä¸ºè§†å£å®½åº¦çš„ 90% */
      height: 80vh;  /* è®¾ç½®é«˜åº¦ä¸ºè§†å£é«˜åº¦çš„ 80% */
      max-width: 100%;
      max-height: 100%;
      display: flex;
      flex-direction: column; /* ä½¿ç”¨ column å¸ƒå±€ï¼Œä½¿æŒ‰é’®åœ¨å›¾ç‰‡ä¸‹æ–¹ */
      justify-content: center;  /* æ°´å¹³å±…ä¸­ */
      align-items: center;  /* å‚ç›´å±…ä¸­ */
      background-color: rgba(0, 0, 0, 0.8);  /* ç¯ç®±èƒŒæ™¯ */
      padding: 20px;
      border-radius: 14px;
      overflow: hidden;
    }
    .lightbox img {
      width: 100%;
      height: 100%;
      object-fit: contain;  /* ç¡®ä¿å›¾ç‰‡å®Œæ•´æ˜¾ç¤ºï¼Œä¸è£å‰ª */
      max-width: 100%;
      max-height: 100%;
    }
    
    .lightbox .bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 8px 12px;
      background: #0f172b;
      border-bottom: 1px solid var(--border);
    }

    .close {
      background: #0e1630;
      color: #e6edf3;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .lightbox .btns {
      display: flex;
      justify-content: space-between; /* æŒ‰é’®æ°´å¹³é—´éš” */
      width: 100%;
      padding: 10px 0;
      background: #0f172b;
      border-top: 1px solid var(--border);
      margin-top: 10px; /* ä¸ºäº†å’Œå›¾ç‰‡ä¿æŒé—´éš” */
    }

    .lightbox .btns button {
      background: #0f172b;
      color: #e6edf3;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .lightbox .btns button:hover {
      background: #9fe6a0; /* é¼ æ ‡æ‚¬åœæ—¶æ”¹å˜æŒ‰é’®é¢œè‰² */
    }
    
   /* ç™»å½•æ ·å¼ */
    .login-container {
      max-width: 400px;
      margin: 100px auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
    }
    .login-container h2 {
      text-align: center;
      color: var(--fg);
      margin-bottom: 20px;
    }
    .login-container label {
      display: block;
      margin-bottom: 5px;
      color: var(--fg);
    }
    .login-container input {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #0f1528;
      color: var(--fg);
    }
    .login-container button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: var(--accent);
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    .login-container button:hover {
      background: var(--accent2);
    }
  </style>
</head>
<body>
  <!-- ç™»å½•ç•Œé¢ -->
  <div id="loginPage" class="login-container">
    <h2>ç™»å½•</h2>
    <label for="username">ç”¨æˆ·å</label>
    <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
    <label for="password">å¯†ç </label>
    <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
    <button id="loginBtn">ç™»å½•</button>
    <p id="error" style="color: red; display: none;">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚</p>
  </div>

  <div id="main" style="display:none;">
  <header>
    <div class="container nav" aria-label="ä¸»å¯¼èˆª">
      <div class="brand"><div class="logo" aria-hidden="true">âœ¦</div><span>æˆ‘çš„æ—…è¡Œæ—¶é—´çº¿</span></div>
      <nav aria-label="è¾…åŠ©é“¾æ¥">
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <h1>æŒ‰æ—¶é—´è®°å½•æˆ‘çš„æ—…è¡Œ</h1>
      </div>
    </section>

    <!-- å·¥å…·æ  -->
    <section class="container">
      <div class="toolbar">
        <strong>å¹´ä»½ï¼š</strong>
        <select id="yearSel" class="input">
          <option value="all">å…¨éƒ¨å¹´ä»½</option>
        </select>

        <strong>èŒƒå›´ï¼š</strong>
        <div id="scopeWrap" style="display:flex; gap:8px; flex-wrap:wrap"></div>

        <input id="q" class="input" style="flex:1; min-width:200px" placeholder="æœç´¢ï¼šæ ‡é¢˜ / å¤‡æ³¨ / çœä»½ / å›½å®¶"/>
      </div>

      <!-- ä»…åœ¨ scope=å›½å†… æ—¶æ˜¾ç¤º -->
      <div class="subbar" id="provBar" hidden>
        <strong>çœä»½ï¼š</strong>
        <div id="provWrap" style="display:flex; gap:8px; flex-wrap:wrap"></div>
      </div>
    </section>

    <!-- æ¨ªå‘æ—¶é—´è½´ -->
    <div class="year-rail-wrap">
      <div class="container">
        <div id="yearRail" class="year-rail" role="tablist" aria-label="å¹´ä»½æ—¶é—´è½´">
          <!-- JS æ¸²æŸ“å¹´ä»½ä¸æœˆä»½ pill -->
        </div>
      </div>
    </div>

    <!-- çºµå‘æ—¶é—´çº¿ -->
    <section class="container timeline card" id="timeline" aria-label="æ—…è¡Œæ—¶é—´çº¿"></section>

    <!-- å›¾ç‰‡ç¯ç®± -->
    <dialog class="lightbox" id="dlg" aria-label="å›¾ç‰‡é¢„è§ˆ">
      <div class="bar">
        <button class="close" id="closeBtn" aria-label="å…³é—­é¢„è§ˆ">å…³é—­</button>
      </div>
      <div class="btns">
        <button id="prevBtn">ä¸Šä¸€å¼ </button>
        <button id="nextBtn">ä¸‹ä¸€å¼ </button>
      </div>
      <img id="big" alt="å›¾ç‰‡é¢„è§ˆ">
    </dialog>
  </main>

  <footer>
    <div class="container" style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap">
      <span>Â© <span id="year"></span> å°å®‡æµ©Â·èµ°è½¯ä½œä¸š</span>
    </div>
  </footer>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
  // é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç 
  const DEFAULT_USERNAME = "yinshuaji";
  const DEFAULT_PASSWORD = "123456";

  // ç™»å½•åŠŸèƒ½
  document.getElementById("loginBtn").addEventListener("click", function() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    if (username === DEFAULT_USERNAME && password === DEFAULT_PASSWORD) {
      // ç™»å½•æˆåŠŸï¼Œæ˜¾ç¤ºä¸»é¡µé¢ï¼Œéšè—ç™»å½•ç•Œé¢
      document.getElementById("loginPage").style.display = "none";
      document.getElementById("main").style.display = "block";
    } else {
      // ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      document.getElementById("error").style.display = "block";
    }
  });
});
    
    // å¹´ä»½
    document.getElementById('year').textContent = new Date().getFullYear();

    // æ—…è¡Œæ•°æ®
     const TRIPS = [
      { id:"201109-hangzhou", date:"2011-09", title:"æ­å·", scope:"å›½å†…", province:"æµ™æ±Ÿ", cover:"images/201109æ­å·3.jpg", gallery:["images/201109æ­å·1.jpg","images/201109æ­å·2.jpg"] },
      { id:"201410-tianjin", date:"2014-10", title:"å¤©æ´¥", scope:"å›½å†…", province:"å¤©æ´¥", cover:"images/201410å¤©æ´¥3.JPG", gallery:["images/201410å¤©æ´¥1.JPG","images/201410å¤©æ´¥4.JPG","images/201410å¤©æ´¥5.JPG"]},
      { id:"201502-harbin", date:"2015-02", title:"å“ˆå°”æ»¨å†°é›ªèŠ‚", scope:"å›½å†…", province:"é»‘é¾™æ±Ÿ", cover:"images/201502å“ˆå°”æ»¨1.JPG", gallery:["images/201502å“ˆå°”æ»¨2.JPG","images/201502å“ˆå°”æ»¨3.JPG","images/201502å“ˆå°”æ»¨4.JPG"] },
      { id:"201508-changzhou", date:"2015-08", title:"å¸¸å·æ°´ä¸Šä¹å›­", scope:"å›½å†…", province:"æ±Ÿè‹", cover:"images/201508å—äº¬ã€å¸¸å·3.jpg", gallery:[] },
      { id:"201508-nanjing", date:"2015-08", title:"å—äº¬", scope:"å›½å†…", province:"æ±Ÿè‹", cover:"images/201508å—äº¬ã€å¸¸å·2.jpg", gallery:["images/201508å—äº¬ã€å¸¸å·2.jpg","images/201508å—äº¬ã€å¸¸å·4.jpg","images/201508å—äº¬ã€å¸¸å·5.jpg"] },
      { id:"201608-shanghai", date:"2016-08", title:"ä¸Šæµ·", scope:"å›½å†…", province:"ä¸Šæµ·", cover:"images/201608ä¸Šæµ·4.JPG", gallery:["images/201608ä¸Šæµ·1.JPG","images/201608ä¸Šæµ·2.JPG","images/201608ä¸Šæµ·3.JPG"] },
      { id:"201710-suzhou", date:"2017-10", title:"è‹å·", scope:"å›½å†…", province:"æ±Ÿè‹", cover:"images/201710è‹å·.JPG", gallery:[] },
      { id:"201802-xian", date:"2018-02", title:"è¥¿å®‰", scope:"å›½å†…", province:"é™•è¥¿", cover:"images/201802è¥¿å®‰ã€å£¶å£ç€‘å¸ƒ1.JPG", gallery:["images/201802è¥¿å®‰ã€å£¶å£ç€‘å¸ƒ2.JPG","images/201802è¥¿å®‰ã€å£¶å£ç€‘å¸ƒ3.JPG"] },
      { id:"201808-xiong'an", date:"2018-08", title:"é›„å®‰", scope:"å›½å†…", province:"æ²³åŒ—", cover:"images/201808é›„å®‰ã€ç™½æ´‹æ·€1.JPG", gallery:["images/201808é›„å®‰ã€ç™½æ´‹æ·€2.JPG"] },
      { id:"201810-chengdu", date:"2018-10", title:"æˆéƒ½", scope:"å›½å†…", province:"å››å·", cover:"images/201810æˆéƒ½ã€é’åŸå±±ã€éƒ½æ±Ÿå °1.JPG", gallery:["images/201810æˆéƒ½ã€é’åŸå±±ã€éƒ½æ±Ÿå °2.JPG","images/201810æˆéƒ½ã€é’åŸå±±ã€éƒ½æ±Ÿå °3.JPG","images/201810æˆéƒ½ã€é’åŸå±±ã€éƒ½æ±Ÿå °4.JPG"] },
      { id:"201910-anyang", date:"2019-10", title:"å®‰é˜³", scope:"å›½å†…", province:"æ²³å—", cover:"images/201910å®‰é˜³2.JPG", gallery:["images/201910å®‰é˜³1.JPG","images/201910å®‰é˜³3.JPG","images/201910å®‰é˜³4.jpg"] },
      { id:"202105-luoyang", date:"2021-05", title:"æ´›é˜³", scope:"å›½å†…", province:"æ²³å—", cover:"images/202105æ´›é˜³.JPG", gallery:[] },
      { id:"202508-yangzhou", date:"2025-08", title:"æ‰¬å·", scope:"å›½å†…", province:"æ±Ÿè‹", cover:"images/202508æ‰¬å·1.JPG", gallery:["images/202508æ‰¬å·2.jpg","images/202508æ‰¬å·3.jpg","images/202508æ‰¬å·4.jpg","images/202508æ‰¬å·5.jpg","images/202508æ‰¬å·6.JPG"] },
      { id:"202001-yunnan", date:"2020-01", title:"äº‘å—", scope:"å›½å†…", province:"äº‘å—", cover:"images/202001äº‘å—1.JPG", gallery:["images/202001äº‘å—2.JPG","images/202001äº‘å—3.JPG","images/202001äº‘å—4.JPG","images/202001äº‘å—5.JPG","images/202001äº‘å—6.JPG"] },
      { id:"202307-shenyang", date:"2023-07", title:"æ²ˆé˜³", scope:"å›½å†…", province:"è¾½å®", cover:"images/202307æ²ˆé˜³1.jpg", gallery:["images/202307æ²ˆé˜³2.jpg","images/202307æ²ˆé˜³3.jpg"] },
      { id:"202310-wuxi", date:"2023-10", title:"æ— é”¡", scope:"å›½å†…", province:"æ±Ÿè‹", cover:"images/202310æ— é”¡2.jpg", gallery:["images/202310æ— é”¡1.jpg","images/202310æ— é”¡3.jpg"] },
      { id:"202401-guangzhou", date:"2024-01", title:"å¹¿å·", scope:"å›½å†…", province:"å¹¿ä¸œ", cover:"images/202401å¹¿å·7.jpg", gallery:["images/202401å¹¿å·8.jpg","images/202401å¹¿å·3.jpg","images/202401å¹¿å·4.jpg","images/202401å¹¿å·6.jpg"] },
      { id:"201608-korea", date:"2016-08", title:"éŸ©å›½", scope:"å›½å¤–", province:"", cover:"images/201608éŸ©å›½æ¸¸è½®æ¸¸1.JPG", gallery:["images/201608éŸ©å›½æ¸¸è½®æ¸¸2.JPG","images/201608éŸ©å›½æ¸¸è½®æ¸¸3.JPG","images/201608éŸ©å›½æ¸¸è½®æ¸¸4.JPG"] },
      { id:"202406-dunhuang", date:"2024-06", title:"æ•¦ç…Œ", scope:"å›½å†…", province:"ç”˜è‚ƒ", cover:"images/202406æ•¦ç…Œ1.jpg", gallery:["images/202406æ•¦ç…Œ2.jpg", "images/202406æ•¦ç…Œ3.jpg","images/202406æ•¦ç…Œ4.jpg","images/202406æ•¦ç…Œ5.jpg","images/202406æ•¦ç…Œ6.jpg"] },
      { id:"201407-hongkong", date:"2014-07", title:"é¦™æ¸¯", scope:"å›½å†…", province:"é¦™æ¸¯", cover:"images/ç»´æ¸¯-å¼€å¿ƒçš„å‰ªåˆ€æ‰‹.JPG", gallery:[] },
      { id:"201407-macau", date:"2014-07", title:"æ¾³é—¨", scope:"å›½å†…", province:"æ¾³é—¨", cover:"images/å¨å°¼æ–¯äºº3.JPG", gallery:["images/2014æ¾³é—¨.JPG"] },
      { id:"201407-shenzhen", date:"2014-07", title:"æ·±åœ³", scope:"å›½å†…", province:"å¹¿ä¸œ", cover:"images/ä¸–ç•Œä¹‹çª—4.JPG", gallery:["images/æ°‘ä¿—æ‘2.JPG"] },
      { id:"201511-beijing", date:"2015-11", title:"åŒ—äº¬", scope:"å›½å†…", province:"åŒ—äº¬", cover:"images/201511åŒ—å¤§ã€ç«è½¦åšç‰©é¦†3.JPG", gallery:["images/201511åŒ—å¤§ã€ç«è½¦åšç‰©é¦†1.JPG","images/201511åŒ—å¤§ã€ç«è½¦åšç‰©é¦†2.JPG","images/201511åŒ—å¤§ã€ç«è½¦åšç‰©é¦†4.JPG"] },
      { id:"201908-zhengzhou", date:"2019-08", title:"éƒ‘å·", scope:"å›½å†…", province:"æ²³å—", cover:"images/201908éƒ‘å·ã€å°‘æ—å¯ºã€é‡åº†ã€ä¸‰å³¡ã€æ­¦æ±‰1.JPG", gallery:["images/201908éƒ‘å·ã€å°‘æ—å¯ºã€é‡åº†ã€ä¸‰å³¡ã€æ­¦æ±‰2.JPG"] },
      { id:"201908-wuhan", date:"2019-08", title:"æ­¦æ±‰", scope:"å›½å†…", province:"æ¹–åŒ—", cover:"images/201908éƒ‘å·ã€å°‘æ—å¯ºã€é‡åº†ã€ä¸‰å³¡ã€æ­¦æ±‰7.JPG", gallery:["images/201908éƒ‘å·ã€å°‘æ—å¯ºã€é‡åº†ã€ä¸‰å³¡ã€æ­¦æ±‰7.JPG"] },
      { id:"201708-netherlands", date:"2017-08", title:"è·å…°", scope:"å›½å¤–", province:"", cover:"images/é˜¿å§†æ–¯ç‰¹ä¸¹1.jpg", gallery:[] },
      { id:"201708-germany", date:"2017-08", title:"å¾·å›½", scope:"å›½å¤–", province:"", cover:"images/ç§‘éš†å¤§æ•™å ‚2.jpg", gallery:["images/å¾·å›½åˆå½±.jpg"] }
    ];

    // ==== 2) çŠ¶æ€ ====  
    const state = { year:'all', scope:'å…¨éƒ¨', province:'å…¨éƒ¨', q:'' };
    const yearSel = document.getElementById('yearSel');
    const scopeWrap = document.getElementById('scopeWrap');
    const provBar = document.getElementById('provBar');
    const provWrap = document.getElementById('provWrap');
    const yearRail = document.getElementById('yearRail');

    // å¹´ä»½åˆ—è¡¨
    const years = Array.from(new Set(TRIPS.map(t => t.date.slice(0, 7)))).sort((a, b) => b - a);
    years.forEach(y => { 
      const opt = document.createElement('option'); 
      opt.value = y; 
      opt.textContent = y; 
      yearSel.appendChild(opt); 
    });

    // èŒƒå›´èŠ¯ç‰‡
    ['å…¨éƒ¨', 'å›½å†…', 'å›½å¤–'].forEach(s => { 
      const b = document.createElement('button');
      b.className = 'chip' + (s === 'å…¨éƒ¨' ? ' active' : '');
      b.textContent = s; 
      b.dataset.scope = s;
      scopeWrap.appendChild(b);
    });

    // çœä»½èŠ¯ç‰‡
    function buildProvinces() {
      provWrap.innerHTML = '';
      const set = new Set(['å…¨éƒ¨']);
      TRIPS.filter(t => t.scope === 'å›½å†…' && t.province).forEach(t => set.add(t.province));
      Array.from(set).forEach(p => {
        const b = document.createElement('button');
        b.className = 'chip' + (p === 'å…¨éƒ¨' ? ' active' : '');
        b.textContent = p; 
        b.dataset.province = p; 
        provWrap.appendChild(b);
      });
    }
    buildProvinces();

    // æ¨ªå‘æ—¶é—´è½´ pills
    function buildYearRail() {
      yearRail.innerHTML = '';
      years.forEach(y => {
        const a = document.createElement('button');
        a.className = 'year-pill';
        a.textContent = y; 
        a.dataset.year = y; 
        a.setAttribute('role', 'tab');
        yearRail.appendChild(a);
      });
    }
    buildYearRail();

    // ==== 3) äº¤äº’ ====  
    document.getElementById('q').addEventListener('input', (e) => { 
      state.q = (e.target.value || '').toLowerCase().trim(); 
      render(); 
    });
    yearSel.addEventListener('change', () => { 
      state.year = yearSel.value; 
      render(true); 
    });
    scopeWrap.addEventListener('click', (e) => { 
      const btn = e.target.closest('button.chip'); 
      if (!btn) return;
      scopeWrap.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
      btn.classList.add('active'); 
      state.scope = btn.dataset.scope;
      const showProv = state.scope === 'å›½å†…';
      provBar.hidden = !showProv;
      state.province = 'å…¨éƒ¨';
      if (showProv) {
        provWrap.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
        const first = provWrap.querySelector('[data-province="å…¨éƒ¨"]'); 
        if (first) first.classList.add('active');
      }
      render(true); 
    });

    provWrap.addEventListener('click', (e) => { 
      const btn = e.target.closest('button.chip'); 
      if (!btn) return;
      provWrap.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
      btn.classList.add('active'); 
      state.province = btn.dataset.province;
      render(true);
    });

    // æ—¶é—´è½´ç‚¹å‡»è·³è½¬
    yearRail.addEventListener('click', (e) => {
      const btn = e.target.closest('button.year-pill'); 
      if (!btn) return;
      const targetYear = btn.dataset.year;
      const anchor = document.querySelector(`[data-year-anchor="${targetYear}"]`);
      if (anchor) { anchor.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
    });

    function filterTrips(list) {
      return list.filter(t => {
        const yOk = state.year === 'all' || t.date.startsWith(state.year);
        const sOk = state.scope === 'å…¨éƒ¨' || t.scope === state.scope;
        const pOk = state.province === 'å…¨éƒ¨' || t.province === state.province;
        return yOk && sOk && pOk;
      });
    }

    // ==== 4) æ¸²æŸ“ ====  
    function render(rebuildAnchors = false) {
      const wrap = document.getElementById('timeline');
      wrap.innerHTML = '';
      const data = filterTrips([...TRIPS]).sort((a, b) => b.date.localeCompare(a.date));
      if (data.length === 0) {
        const empty = document.createElement('p'); 
        empty.style.color = 'var(--muted)'; 
        empty.style.margin = '16px';
        empty.textContent = 'æ²¡æœ‰åŒ¹é…çš„æ—…è¡Œè®°å½•ã€‚è¯•è¯•æ›´æ¢ç­›é€‰æˆ–å…³é”®è¯ã€‚'; 
        wrap.appendChild(empty); 
        return;
      }

      let curYear = null;
      data.forEach(t => {
        const y = t.date.slice(0, 7); 
        if (curYear !== y) {
          curYear = y;
          const tag = document.createElement('div'); 
          tag.className = 'year'; 
          tag.textContent = y;
          tag.setAttribute('data-year-anchor', y); 
          wrap.appendChild(tag);
        }

        const metaPieces = [
          `<time datetime="${t.date}">${t.date}</time>`,
          t.scope === 'å›½å†…' ? `å›½å†…Â·${t.province || 'æœªå¡«çœä»½'}` : `å›½å¤–${t.country ? 'Â·' + t.country : ''}`
        ];

        const imageCount = (t.gallery || []).length + (t.cover ? 1 : 0);  // cover æ˜¯ 1 æˆ– 0ï¼Œgallery æ˜¯æ•°ç»„é•¿åº¦
        const art = document.createElement('article'); 
        art.className = 'entry card';
        art.innerHTML = `
          <div class="meta">${metaPieces.join(' Â· ')}</div>
          <h3>${t.title}</h3>
          <div class="thumb"><img src="${t.cover || ''}" alt="${t.title} å°é¢" loading="lazy"></div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
            <button class="btn" data-view="${t.id}">æŸ¥çœ‹ç…§ç‰‡ï¼ˆ${imageCount || 1}ï¼‰</button>
          </div>
        `;
        wrap.appendChild(art);
      });

      if (rebuildAnchors) { updateYearRailActive(); }
    }
    render(true);

    // ==== 5) æ—¶é—´è½´æ»šåŠ¨é«˜äº®ï¼ˆIntersectionObserverï¼‰====  
    const yearAnchors = () => Array.from(document.querySelectorAll('[data-year-anchor]'));
    function updateYearRailActive(activeYear) {
      const pills = Array.from(yearRail.querySelectorAll('.year-pill'));
      pills.forEach(p => p.classList.toggle('active', p.dataset.year === activeYear));
    }
    const io = new IntersectionObserver(entries => {
      const visible = entries.filter(e => e.isIntersecting).sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top);
      if (visible[0]) {
        const y = visible[0].target.getAttribute('data-year-anchor');
        updateYearRailActive(y);
      }
    }, { rootMargin: "-64px 0px -70% 0px", threshold: [0, 1] });
    function observeYears() {
      io.disconnect();
      yearAnchors().forEach(el => io.observe(el));
    }
    observeYears();

    // ç›‘å¬â€œæŸ¥çœ‹ç…§ç‰‡â€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.getElementById('timeline').addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-view]'); 
      if (!btn) return;

      const id = btn.dataset.view; 
      const trip = TRIPS.find(x => x.id === id); 
      if (!trip) return;

      // è·å–æ‰€æœ‰å›¾ç‰‡ï¼šå°é¢å›¾ç‰‡ + gallery ä¸­çš„å›¾ç‰‡
      currentPhotos = [trip.cover, ...(trip.gallery || [])].filter(Boolean); 
      currentIndex = 0;
      showPhoto(currentIndex);
      dlg.showModal();
    });

    // æ˜¾ç¤ºå½“å‰ç´¢å¼•çš„å›¾ç‰‡
    function showPhoto(i) {
      if (i < 0 || i >= currentPhotos.length) return; 
      const src = currentPhotos[i]; // è·å–å½“å‰å›¾ç‰‡è·¯å¾„
      const img = big; // è·å–å›¾ç‰‡å…ƒç´ 
      img.src = src;  // è®¾ç½®å›¾ç‰‡è·¯å¾„
      img.alt = 'æ—…è¡Œç…§ç‰‡ ' + (i + 1);  // è®¾ç½®å›¾ç‰‡çš„æè¿°

       img.onload = function() {
       // å›¾ç‰‡åŠ è½½å®Œæˆåè‡ªåŠ¨è°ƒæ•´å¤§å°
       img.style.maxWidth = '100%';
       img.style.maxHeight = '100%';
      img.style.objectFit = 'contain';  // ä½¿ç”¨ contain ç¡®ä¿å›¾ç‰‡å®Œæ•´æ˜¾ç¤º
      };
      dlg.showModal();
    }

   document.addEventListener("DOMContentLoaded", function() {
  // è·å–å¯¹è¯æ¡†å’Œå…³é—­æŒ‰é’®
  const dlg = document.getElementById('dlg');
  const closeBtn = document.getElementById('closeBtn');
  
  // ç¡®ä¿ç‚¹å‡»å…³é—­æŒ‰é’®æ—¶å…³é—­å¯¹è¯æ¡†
  closeBtn.addEventListener('click', function() {
    dlg.close();  // æ­£ç¡®å…³é—­å¯¹è¯æ¡†
  });
});

    // åˆ‡æ¢å›¾ç‰‡
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + currentPhotos.length) % currentPhotos.length; 
      showPhoto(currentIndex);
    });

    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % currentPhotos.length; 
      showPhoto(currentIndex);
    });
  </script>
</body>
</html>










































